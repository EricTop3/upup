define("widget/display",function(t,e,n){function a(t){i([g.peopleImage,g.brandImage,g.handImage],function(e){p=s(h(e[0],g.peopleTotal)),m=s(h(e[1],g.brandTotal)),w=s(h(e[2],g.handTotal)),t()})}function i(t,e){var n=0,a=[];t.forEach(function(i,r){var o=new Image;o.onload=function(){a[r]=o,++n==t.length&&e(a)},o.src=i})}function r(t,e,n,a){for(var i=t.width,r=e.width,o=e.height,h=t.data,s=e.data,c=a;a+o>c;c++)for(var d=n;n+r>d;d++){var l=4*(i*c+d),f=4*(r*(c-a)+d-n);if(0!=s[f+3])if(255==s[f+3])h[l]=s[f],h[l+1]=s[f+1],h[l+2]=s[f+2],h[l+3]=s[f+3];else{var u=t.data[l+3]/255,g=e.data[f+3]/255,p=1-(1-u)*(1-g);if(1e-6>p)return;h[l]=s[f]*g/p+h[l]*u*(1-g)/p,h[l+1]=s[f+1]*g/p+h[l+1]*u*(1-g)/p,h[l+2]=s[f+2]*g/p+h[l+2]*u*(1-g)/p,h[l+3]=255*p}}return t}function o(t,e){var n=document.createElement("canvas");n.width=t,n.height=e;var a=n.getContext("2d");return a._width=t,a._height=e,a}function h(t,e){t.width&&t.height||console.error("无法读取图片宽高");var n=o(t.width,t.height),a=[];n.drawImage(t,0,0);for(var i=0;e>i;i++){var r=n._width/e,h=n._height,s=n.getImageData(r*i,0,r,h);a.push(s)}return a}function s(t){return{array:t,_unpoped:t.slice(),_poped:[],pop:function(){this._unpoped.length||(this._unpoped=this.array.slice(),this._poped=[]);var t=Math.floor(Math.random()*this._unpoped.length),e=this._unpoped.splice(t,1)[0];return this._poped.push(e),e}}}function c(t,e,n){var a=o(e,n);return a.transform(.766044,.242788,-.742788,.766044,34,-5),a.font=g.textStyle,a.textAlign="center",a.textBaseline="middle",a.fillStyle=g.textColor,a.fillText(t,g.textOffsetX,g.textOffsetY),a.getImageData(0,0,e,n)}function d(t){var e=p.pop(),n=m.array[g.brandIndex]||m.pop(),a=w.pop(),i=g.singleItemWidth,h=g.singleItemHeight,s=o(i,h),d=c(t,n.width,n.height),l=s.createImageData(i,h);return r(l,e,g.peopleOffsetX,g.peopleOffsetY),r(l,n,g.brandOffsetX,g.brandOffsetY),r(l,a,g.handOffsetX,g.handOffsetY),r(l,d,g.brandOffsetX,g.brandOffsetY),l}function l(t,e,n){var a=t.split(""),i=Math.round(g.singleItemWidth*e),h=Math.round(g.singleItemHeight*e),s=Math.round(g.singleItemOffsetX*e),c=Math.round(g.singleItemOffsetY*e),l=window.innerWidth,u=Math.floor((l+s)/(i+s)),p=a.length%u==0?0:h+(a.length%u-1)*c,m=(u-1)*c,w=Math.floor(a.length/u)*h+Math.max(p,m),y=Math.min(l,a.length*(i+s)-s),I=o(y,w),_=I.createImageData(y,w);return a.forEach(function(t,a){var o=n?v[a]:d(t);v[a]=o,o=f(o,e,e);var l=a%u,g=Math.floor(a/u);r(_,o,(i+s)*l,h*g+c*l)}),_}function f(t,e,n){var a=o(t.width,t.height),i=o(t.width*e,t.height*n);return a.putImageData(t,0,0),i.scale(e,n),i.drawImage(a.canvas,0,0),i.getImageData(0,0,t.width*e,t.height*n)}function u(t,e){return t.fillStyle=e,t.fillRect(0,0,t._width,t._height),t}var g=t("widget/display/config.js"),p=null,m=null,w=null,v=[];n.exports=Vue.extend({template:'<div class="w-display" :style="{backgroundColor: color}">\n    <div class="w-display_img" v-el="imageWrap">\n        <img :src="src">\n    </div>\n\n    <div class="w-display_zoom">\n        <w-zoom :scale.sync="scale"></w-zoom>\n    </div>\n    <a class="w-display_refresh" @click.prevent.stop="refresh"></a>\n</div>\n',data:function(){return{src:"",contentLayer:""}},props:["content","scale","color"],components:{"w-zoom":t("widget/zoom")},ready:function(){var t=this;a(function(){t.contentLayer=l(t.content,t.scale),t.draw()})},watch:{content:function(t){this.contentLayer=l(t,this.scale),this.draw()},scale:function(t){this.contentLayer=l(this.content,t,!0),this.draw()},color:function(){this.draw()}},methods:{refresh:function(){this.contentLayer=l(this.content,this.scale),this.draw()},draw:function(){var t=this.contentLayer.width,e=this.contentLayer.height,n=o(t,e);u(n,this.color);var a=r(n.getImageData(0,0,t,e),this.contentLayer,0,0);n.putImageData(a,0,0),this.src=n.canvas.toDataURL()}}})});