define("widget/display",function(t,e,n){function a(t){i([g.peopleImage,g.brandImage,g.handImage],function(e){p=s(h(e[0],g.peopleTotal)),u=s(h(e[1],g.brandTotal)),w=s(h(e[2],g.handTotal)),t()})}function i(t,e){var n=0,a=[];t.forEach(function(i,o){var r=new Image;r.onload=function(){a[o]=r,n++,n==t.length&&e(a)},r.src=i})}function o(t,e){var n=document.createElement("canvas");n.width=t,n.height=e;var a=n.getContext("2d");return a._width=t,a._height=e,a}function r(t){var e=new Image;return e._width=t._width,e._height=t._height,e.src=t.canvas.toDataURL("image/png",1),e}function h(t,e){t.width&&t.height||console.error("无法读取图片宽高");var n=o(t.width,t.height),a=[];n.drawImage(t,0,0);for(var i=0;e>i;i++){var h=n._width/e,s=n._height,d=n.getImageData(h*i,0,h,s),c=o(h,s);c.putImageData(d,0,0),a.push(r(c))}return a}function s(t){return{array:t,_unpoped:t.slice(),_poped:[],pop:function(){this._unpoped.length||(this._unpoped=this.array.slice(),this._poped=[]);var t=Math.floor(Math.random()*this._unpoped.length),e=this._unpoped.splice(t,1)[0];return this._poped.push(e),e}}}function d(t,e,n){var a=o(e,n);a.transform(.766044,.242788,-.742788,.766044,34,-5),a.font=g.textStyle,a.textAlign="center",a.textBaseline="middle",a.fillStyle=g.textColor,a.fillText(t,g.textOffsetX,g.textOffsetY);var i=r(a);return i}function c(t,e){var n=p.pop(),a=u.array[g.brandIndex]||u.pop(),i=w.pop(),r=g.singleItemWidth*e,h=g.singleItemHeight*e,s=o(r,h),c=d(t,a._width,a._height);return s.scale(e,e),s.drawImage(n,0,0,n._width,n._height,g.peopleOffsetX,g.peopleOffsetY,n._width,n._height),s.drawImage(a,0,0,a._width,a._height,g.brandOffsetX,g.brandOffsetY,a._width,a._height),s.drawImage(i,0,0,i._width,i._height,g.handOffsetX,g.handOffsetY,i._width,i._height),s.drawImage(c,0,0,a._width,a._height,g.brandOffsetX,g.brandOffsetY,a._width,a._height),s}function l(t,e){var n=t.split(""),a=g.singleItemWidth*e,i=g.singleItemHeight*e,h=g.singleItemOffsetX*e,s=g.singleItemOffsetY*e,d=window.innerWidth,l=Math.floor((d+h)/(a+h)),f=n.length%l==0?0:i+(n.length%l-1)*s,p=(l-1)*s,u=Math.floor(n.length/l)*i+Math.max(f,p),w=o(d,u);return n.forEach(function(t,n){var o=r(c(t,e)),d=n%l,f=Math.floor(n/l);o.onload=function(){w.drawImage(o,0,0,a,i,(a+h)*d,i*f+s*d,a,i)}}),w}function f(t,e){return t.fillStyle=e,t.fillRect(0,0,t._width,t._height),t}var g=t("widget/display/config.js"),p=null,u=null,w=null;n.exports=Vue.extend({template:'<div class="w-display" :style="{backgroundColor: color}">\n    <div class="w-display_img" v-el="imageWrap">\n        <img :src="src">\n    </div> \n\n    <div class="w-display_zoom">\n        <w-zoom :scale.sync="scale"></w-zoom>\n    </div>\n    <a class="w-display_refresh" @click.prevent.stop="refresh"></a>\n</div>',data:function(){return{src:"",contentLayer:""}},props:["content","scale","color"],components:{"w-zoom":t("widget/zoom")},ready:function(){var t=this;a(function(){t.contentLayer=l(t.content,t.scale),t.draw()})},watch:{content:function(t){this.contentLayer=l(t,this.scale),this.draw()},scale:function(t){this.contentLayer=l(this.content,t),this.draw()},color:function(){this.draw()}},methods:{refresh:function(){this.contentLayer=l(this.content,this.scale),this.draw()},draw:function(){var t=this,e=o(this.contentLayer._width,this.contentLayer._height);f(e,this.color);var n=r(this.contentLayer);n.onload=function(){e.drawImage(r(t.contentLayer),0,0),t.src=e.canvas.toDataURL()}}}})});